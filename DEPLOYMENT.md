# Инструкция по развертыванию Clarity в Telegram

## Шаг 1: Создание бота в Telegram

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям:
   - Введите имя бота (например: "Clarity")
   - Введите username бота (должен заканчиваться на `bot`, например: `clarity_bot`)
4. Сохраните полученный **токен бота** (понадобится позже)

## Шаг 2: Регистрация Mini App

1. В том же чате с BotFather отправьте команду `/newapp`
2. Выберите созданного бота из списка
3. Введите название приложения (например: "Clarity")
4. Загрузите иконку приложения (опционально, но рекомендуется)
5. Введите описание приложения
6. BotFather создаст Mini App и предоставит ссылку вида: `https://t.me/your_bot/clarity`

**Важно:** На этом этапе можно указать временный URL (например, `https://example.com`), его можно изменить позже.

## Шаг 3: Подготовка приложения к развертыванию

### 3.1. Сборка проекта

```bash
npm run build
```

Это создаст папку `dist/` с готовыми файлами для развертывания.

### 3.2. Требования к хостингу

- **HTTPS обязателен** (Telegram требует безопасное соединение)
- Поддержка статических файлов
- CORS настройки (если нужно)

### 3.3. Варианты хостинга

#### Вариант A: Vercel (рекомендуется для быстрого старта)

1. Установите Vercel CLI: `npm i -g vercel`
2. Войдите: `vercel login`
3. Разверните: `vercel --prod`
4. Vercel автоматически предоставит HTTPS URL

#### Вариант B: Netlify (с автоматическим деплоем через GitHub) - РЕКОМЕНДУЕТСЯ

**Настройка автоматического деплоя:**

1. **Создайте репозиторий на GitHub:**
   ```bash
   # Инициализируйте git (если еще не сделано)
   git init
   
   # Добавьте все файлы
   git add .
   
   # Сделайте первый коммит
   git commit -m "Initial commit"
   
   # Создайте репозиторий на GitHub и добавьте remote
   git remote add origin https://github.com/ваш-username/clarity.git
   git branch -M main
   git push -u origin main
   ```

2. **Подключите к Netlify:**
   - Откройте [Netlify](https://app.netlify.com)
   - Нажмите "Add new site" → "Import an existing project"
   - Выберите "GitHub" и авторизуйтесь
   - Выберите ваш репозиторий `clarity`

3. **Настройки сборки (Netlify автоматически определит из `netlify.toml`):**
   - Build command: `npm run build`
   - Publish directory: `dist`
   - Node version: `18` (или выше)

4. **Нажмите "Deploy site"**

5. **Готово!** Теперь при каждом `git push` в `main` ветку Netlify автоматически:
   - Установит зависимости
   - Соберет проект
   - Развернет новую версию

**Альтернатива: Ручной деплой (без GitHub)**

Если нужен разовый деплой без автоматизации:
1. Установите Netlify CLI: `npm i -g netlify-cli`
2. Войдите: `netlify login`
3. Разверните: `netlify deploy --prod --dir=dist`

#### Вариант C: GitHub Pages (требует настройки)

1. Создайте репозиторий на GitHub
2. Настройте GitHub Actions для автоматического деплоя
3. Включите GitHub Pages в настройках репозитория

#### Вариант D: Свой сервер

1. Загрузите содержимое папки `dist/` на сервер
2. Настройте веб-сервер (nginx, Apache) для обслуживания статических файлов
3. Настройте SSL сертификат (Let's Encrypt)

## Шаг 4: Настройка URL в BotFather

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/myapps`
3. Выберите ваше приложение
4. Выберите опцию для изменения URL
5. Введите полный HTTPS URL вашего развернутого приложения (например: `https://your-app.vercel.app`)

**Важно:** URL должен быть доступен публично и использовать HTTPS.

## Шаг 5: Тестирование

### 5.1. Тестовая среда (рекомендуется для разработки)

Telegram предоставляет тестовую среду для разработки:

**iOS:**
- Нажмите 10 раз на иконку Settings
- Accounts > Login to another account > Test

**Android:**
- В настройках Telegram найдите версию приложения
- Нажмите на версию несколько раз для открытия Debug Settings

**Telegram Desktop:**
- Settings > Advanced > Experimental settings > Enable webview inspection

В тестовой среде:
- Создайте нового бота через @BotFather в тестовом режиме
- Используйте HTTP (без S) для тестирования
- Команды отправляйте на `https://api.telegram.org/bot<token>/test/METHOD_NAME`

### 5.2. Запуск приложения

1. Откройте вашего бота в Telegram
2. Нажмите на кнопку меню (или используйте команду `/start`)
3. Если настроена кнопка Mini App, нажмите на неё
4. Или используйте прямую ссылку: `https://t.me/your_bot/clarity`

## Шаг 6: Настройка кнопки меню (опционально)

Чтобы добавить кнопку для запуска Mini App в меню бота:

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/setmenubutton`
3. Выберите вашего бота
4. Введите текст кнопки (например: "Открыть Clarity")
5. Введите URL вашего Mini App или используйте формат: `https://t.me/your_bot/clarity`

## Проверка работоспособности

После развертывания проверьте:

- ✅ Приложение открывается в Telegram
- ✅ Отображается список задач
- ✅ Можно создавать новые задачи
- ✅ Данные сохраняются (Cloud Storage работает)
- ✅ Навигация работает плавно
- ✅ Анимации отображаются корректно

## Отладка

### Проблемы с открытием приложения

- Проверьте, что URL указан правильно в BotFather
- Убедитесь, что используется HTTPS
- Проверьте, что приложение доступно публично

### Проблемы с Cloud Storage

- Убедитесь, что SDK инициализирован правильно
- Проверьте консоль браузера на ошибки
- Используйте тестовую среду для отладки

### Просмотр логов

**iOS:**
- Safari > Develop > [Your Device] > [Your Mini App]

**Android:**
- Chrome > `chrome://inspect/#devices`
- Включите WebView Debug в настройках Telegram

## Дополнительные ресурсы

- [Официальная документация Telegram Mini Apps](https://core.telegram.org/bots/webapps)
- [Документация по созданию Mini App](https://docs.telegram-mini-apps.com/platform/creating-new-app)
- [tma.js документация](https://github.com/Telegram-Mini-Apps/tma.js)

